<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>County Bot RAN — Chat</title>
  <style>
    :root { --bg:#0b0c0f; --fg:#e9edf1; --muted:#9aa4ad; --card:#151922; --accent:#3aa0ff; }
    html,body { height:100%; }
    body { margin:0; background:var(--bg); color:var(--fg); font:16px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Arial; display:flex; flex-direction:column; }
    header { padding:14px 16px; font-weight:700; border-bottom:1px solid #ffffff1a; }
    #chat { flex:1; overflow:auto; padding:18px 16px; display:flex; flex-direction:column; gap:10px; }
    .msg { max-width:820px; margin:0 auto; display:flex; gap:10px; }
    .msg.you  .bubble { background:#2b3342; }
    .msg.bot  .bubble { background:var(--card); border:1px solid #ffffff12; }
    .bubble { padding:12px 14px; border-radius:14px; }
    .who { color:var(--muted); font-size:12px; margin-bottom:4px; }
    form { display:flex; gap:10px; padding:12px; border-top:1px solid #ffffff1a; background:#0e1117; }
    input[type="text"] { flex:1; padding:12px 14px; border-radius:12px; border:1px solid #2a3443; background:#0b0f16; color:var(--fg); outline:none; }
    button { padding:12px 16px; border-radius:12px; border:1px solid #2a3443; background:var(--accent); color:#001428; font-weight:700; cursor:pointer; }
    .muted { color:var(--muted); font-size:13px; }
    details { max-width:820px; margin:8px auto 0; }
    summary { cursor:pointer; }
    .kv { display:grid; grid-template-columns:160px 1fr; gap:4px 10px; font-size:14px; padding:10px; background:#0b0f16; border:1px solid #ffffff12; border-radius:10px; }
    .kv div { padding:2px 0; }
  </style>
</head>
<body>
  <header>County Bot RAN — Chat</header>

  <main id="chat" aria-live="polite">
    <div class="msg bot">
      <div class="bubble">
        <div class="who">Bot</div>
        Ask me things like:
        <ul>
          <li>“Population of Madison County, Alabama?”</li>
          <li>“Hispanic population in Limestone County?”</li>
          <li>“Projected Hispanic population for DeKalb County?”</li>
          <li>“Which region is Colbert County in?”</li>
        </ul>
      </div>
    </div>
  </main>

  <form id="f">
    <input id="q" type="text" placeholder="Type a question (e.g., “Hispanic population in Limestone County”)…" autocomplete="off" />
    <button>Ask</button>
  </form>

  <script>
    const chat = document.getElementById('chat');
    const form = document.getElementById('f');
    const box  = document.getElementById('q');

    function addMsg(who, text, data) {
      const wrap = document.createElement('div');
      wrap.className = `msg ${who}`;
      const b = document.createElement('div');
      b.className = 'bubble';
      const w = document.createElement('div');
      w.className = 'who';
      w.textContent = who === 'you' ? 'You' : 'Bot';
      const p = document.createElement('div');
      p.innerText = text;
      b.appendChild(w);
      b.appendChild(p);

      // Optional: show data details for debugging
      if (data && typeof data === 'object') {
        const det = document.createElement('details');
        det.innerHTML = `<summary class="muted">Details</summary>`;
        const kv = document.createElement('div');
        kv.className = 'kv';
        kv.innerHTML = Object.entries(data)
          .filter(([k,v]) => v != null && v !== '')
          .map(([k,v]) => `<div>${k}</div><div>${v}</div>`).join('');
        det.appendChild(kv);
        b.appendChild(det);
      }

      wrap.appendChild(b);
      chat.appendChild(wrap);
      chat.scrollTop = chat.scrollHeight;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const q = box.value.trim();
      if (!q) return;
      addMsg('you', q);
      box.value = '';

      try {
        // Just send q. The backend handles parsing & search.
        const r = await fetch('/ask?' + new URLSearchParams({ q }));
        const data = await r.json();
        addMsg('bot', data.text || 'No answer.', data.data);
      } catch (err) {
        addMsg('bot', 'Sorry—there was a network error.');
      }
    });

    // Focus the box on load
    box.focus();
  </script>
</body>
</html>
